## CV HD
hd_pi_dCov_df <- hd_pi_dCov %>% dplyr::filter(t >= 1973 & t <= 1983)
hd_pi_dCov_df
## CV HD
hd_pi_dCov_df <- hd_pi_dCov %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
hd_pi_dCov_df
colnames(hd_pi_dCov_df)[2,3] <- c("d", "s")
## CV HD
hd_pi_dCov_df <- hd_pi_dCov %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
colnames(hd_pi_dCov_df)[2,3] <- c("d", "s")
c("d", "s")
colnames(hd_pi_dCov_df)[2,3]
colnames(hd_pi_dCov_df)[,c(2,3)] <- c("d", "s")
colnames(hd_pi_dCov_df)[c(2,3)]
## CV HD
hd_pi_dCov_df <- hd_pi_dCov %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
colnames(hd_pi_dCov_df)[c(2,3)] <- c("d", "s")
hd_pi_dCov_df %<>% reshape2::melt(id = "t")
hd_dCov_plot <- hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_mp$t[1] %>% ceiling(),hd_pi_mp$t[nrow(hd_pi_mp)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +   xlab("") + ylab("")
hd_dCov_plot <- hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +   xlab("") + ylab("")
recessions_start <- c( 1973.75, 1980,1981.5)
recessions_end <- c( 1975, 1980.5,1982.75)
hd_dCov_plot <- hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +   xlab("") + ylab("")
hd_dCov_plot
hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
s
hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +  xlab("") + ylab("")
hd_dCov_plot <- hd_pi_dCov_df %>% ggplot(aes(x = t, y = variable)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
#scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +  xlab("") + ylab("")
hd_dCov_plot
hd_pi_dCov_df
hd_dCov_plot <- hd_pi_dCov_df %>% ggplot(aes(x = t, y = value)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_dCov_df$t[1] %>% ceiling(),hd_pi_dCov_df$t[nrow(hd_pi_dCov_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +  xlab("") + ylab("")
hd_dCov_plot
hd_pi_CV %>% plot.hd.mod()
## CV HD
hd_pi_CV_df <- hd_pi_CV %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
colnames(hd_pi_CV_df)[c(2,3)] <- c("d", "s")
hd_pi_dCov_df %<>% reshape2::melt(id = "t")
hd_pi_CV_plot <- hd_pi_CV_df %>% ggplot(aes(x = t, y = value)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_CV_df$t[1] %>% ceiling(),hd_pi_CV_df$t[nrow(hd_pi_CV_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +  xlab("") + ylab("")
# VAR Spesicifation -------------------------------------------------------
## lag length
#VARselect(USA_Tri, lag.max = 8)
var4 <- VAR(USA_Tri, p = 4, type = "const")
#var4 %>% summary
#var4 %>% resid %>% t() %>% write.table(file = "NonFundamentalness/resid.txt", col.names = F, row.names = F)
#apply(USA_Tri, 1, function(x){x-colMeans(USA_Tri)}) %>% t() %>% write.table(file = "NonFundamentalness/dat.txt", col.names = F, row.names = F)
## LM test for serial correlation
#serial.test(var4, type = "BG")
#serial.test(var4, type = "ES")
## detecting structural break
#set.seed(1234)
#chow.test(var4, SB = c(1984, 1), frequency = 4, nboot = 2000) %>% summary
#set.seed(1234)
#chow.test(var4, SB = c(1979, 3), frequency = 4, nboot = 2000) %>% summary
## Gaussianity test
#ICtest::FOBIboot(var4 %>% resid, n.boot = 2000, 1) # test against the last 2 components are gaussian: reject
#ICtest::FOBIboot(var4 %>% resid, n.boot = 2000, 2) # test against the last 1 component is gaussian: reject
#tseries::jarque.bera.test(resid(var4)[,1])
#tseries::jarque.bera.test(resid(var4)[,2])
#tseries::jarque.bera.test(resid(var4)[,3])
# Identification ----------------------------------------------------------
## Sign restrictions
set.seed(1234)
Signmat     <- matrix(c(1,1,1,-1,1,1,NA,-1,1), nrow = 3, ncol = 3)
SR          <- get.id.Sign(var4, Iter = 1000, Itermax = Inf, Signmat = Signmat, RHorizont = 0, Normalize = F, Step = 15, MT = T, Ci = 0.68, Plot = T, Hist = F, Epsname =  c("d", "s", "mp"))
## Identification by change in volatility
set.seed(1234)
CV          <- id.cv(var4, SB = c(1984, 1), frequency = 4)
CV          %>% summary
## Identification by minimizing distance covariance
set.seed(1234)
dCov        <- id.dc(var4)
dCov$B      <- dCov$B[,c(3,2,1)]
dCov$B[,3]  <- dCov$B[,3]*-1
dCov        %>% summary
## Identification by minimizing CvM distance
#set.seed(1234)
#CvM        <- id.cvm(var4, itermax = 2000, steptol = 200, iter2 = 200)
#CvM$B <- CvM$B[,c(3,2,1)]
#CvM$B[,1] <- CvM$B[,1] *-1
#CvM        %>% summary
#CvM %>% irf() %>% plot
#ggsave("../Plots/Tri_CvM.pdf", plot = last_plot(), width = 12, height = 8)
## Proxy SVAR
# Smets-Wouters (2007)
SW.raw      <- read.csv("Data/Instruments/SW.csv")
SW          <- ts(SW.raw[,-1], frequency = 4, start = c(floor(SW.raw$Year[1]), (SW.raw$Year[1] %% 1) / 0.25 + 1 ))
IV.SW       <- get.id.iv(var4, instruments = SW, Synchro = T)
IV.SW$B
IV.SW$F_test
#Box.test(SW, lag = 1, type = "Ljung-Box")
#Box.test(SW, lag = 2, type = "Ljung-Box")
#Box.test(SW, lag = 3, type = "Ljung-Box")
# Guerkaynak, Sack and Swanson (2005)
GSS.raw     <- read.csv("Data/Instruments/GSS.csv")
GSS         <- ts(GSS.raw[,-1], frequency = 4, start = c(floor(GSS.raw$Year[1]), (GSS.raw$Year[1] %% 1) / 0.25 + 1 ))
IV.GSS      <- get.id.iv(var4, instruments = GSS, Synchro = T)
IV.GSS$B
IV.GSS$F_test
# Romer Romer (2004)
RR.raw      <- read.csv("Data/Instruments/RR.csv")
RR          <- ts(RR.raw[,-1], frequency = 4, start = c(floor(RR.raw$Year[1]), (RR.raw$Year[1] %% 1) / 0.25 + 1 ))
RR          <- Remove_AC(RR, lag = 1)
IV.RR       <- get.id.iv(var4, instruments = RR, Synchro = T)
IV.RR$B
IV.RR$F_test
#Box.test(RR, lag = 1, type = "Ljung-Box")
#Box.test(RR, lag = 2, type = "Ljung-Box")
#Box.test(RR, lag = 3, type = "Ljung-Box")
# Sims Zha (2006)
SZ.raw      <- read.csv("Data/Instruments/SZ.csv")
SZ          <- ts(SZ.raw[,-1], frequency = 4, start = c(floor(SZ.raw$Year[1]), (SZ.raw$Year[1] %% 1) / 0.25 + 1 ))
SZ          <- Remove_AC(SZ, 2)
IV.SZ       <- get.id.iv(var4, instruments = SZ, Synchro = T)
IV.SZ$B
IV.SZ$F_test
#Box.test(SZ, lag = 1, type = "Ljung-Box")
#Box.test(SZ, lag = 2, type = "Ljung-Box")
#Box.test(SZ, lag = 3, type = "Ljung-Box")
#Box.test(SZ, lag = 4, type = "Ljung-Box")
graphics.off()
Epsname = c("d", "s", "mp")
# pi ----------------------------------------------------------------------
hd_pi_SR <- hd.mod(SR, series = 2, Partial = NULL, Epsname)
hd_pi_SR_mp <- hd.mod(SR, series = 2, Partial = 3, Epsname)
hd_pi_CV <- hd.mod(CV, series = 2, Partial = NULL, Epsname)
recessions_start <- c( 1973.75, 1980,1981.5)
recessions_end <- c( 1975, 1980.5,1982.75)
## CV HD
hd_pi_CV_df <- hd_pi_CV %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
colnames(hd_pi_CV_df)[c(2,3)] <- c("d", "s")
hd_pi_CV_df %<>% reshape2::melt(id = "t")
hd_pi_CV_plot <- hd_pi_CV_df %>% ggplot(aes(x = t, y = value)) + facet_wrap(~variable, ncol = 1) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_CV_df$t[1] %>% ceiling(),hd_pi_CV_df$t[nrow(hd_pi_CV_df)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line() +  xlab("") + ylab("")
hd_pi_CV_plot
hd_pi_CV_df
hd_pi_CV %>% dplyr::filter(t >= 1973 & t <= 1983) %>% dplyr::select(c(1, 4, 5))
USA_Tri %>% window(from = 1973, to = 1983)
USA_Tri_raw
USA_Tri_raw %>%  dplyr::filter(t >= 1973 & t <= 1983)
USA_Tri_raw %>%  dplyr::filter(Year >= 1973 & Year <= 1983)
USA_Tri_raw %>%  dplyr::filter(Year >= 1973 & Year <= 1983) %>% mean
USA_Tri_raw %>%  dplyr::filter(Year >= 1973 & Year <= 1983) %>% colMeans()
autoplot(USA_Tri, ncol = 1) + theme_bw()
# Load functions ----------------------------------------------------------
rm(list = ls())
Functions <- devtools::as.package("../Functions")
devtools::load_all("../Functions")
library(ggfortify)
library(gridExtra)
library(magrittr)
library(svars)
library(readr)
#devtools::install_github("ropenscilabs/ochRe")
library(ochRe)
# Import data -------------------------------------------------------------
USA_Tri_raw   <- read.csv("Data/USA_Tri.csv")
USA_Tri       <- ts(USA_Tri_raw[,-1], frequency = 4, start = c(floor(USA_Tri_raw$Year[1]), (USA_Tri_raw$Year[1] %% 1) / 0.25 + 1 ))
#autoplot(USA_Tri, ncol = 1) + theme_bw()
# VAR Spesicifation -------------------------------------------------------
## lag length
#VARselect(USA_Tri, lag.max = 8)
var4 <- VAR(USA_Tri, p = 4, type = "const")
#var4 %>% summary
#var4 %>% resid %>% t() %>% write.table(file = "NonFundamentalness/resid.txt", col.names = F, row.names = F)
#apply(USA_Tri, 1, function(x){x-colMeans(USA_Tri)}) %>% t() %>% write.table(file = "NonFundamentalness/dat.txt", col.names = F, row.names = F)
## LM test for serial correlation
#serial.test(var4, type = "BG")
#serial.test(var4, type = "ES")
## detecting structural break
#set.seed(1234)
#chow.test(var4, SB = c(1984, 1), frequency = 4, nboot = 2000) %>% summary
#set.seed(1234)
#chow.test(var4, SB = c(1979, 3), frequency = 4, nboot = 2000) %>% summary
## Gaussianity test
#ICtest::FOBIboot(var4 %>% resid, n.boot = 2000, 1) # test against the last 2 components are gaussian: reject
#ICtest::FOBIboot(var4 %>% resid, n.boot = 2000, 2) # test against the last 1 component is gaussian: reject
#tseries::jarque.bera.test(resid(var4)[,1])
#tseries::jarque.bera.test(resid(var4)[,2])
#tseries::jarque.bera.test(resid(var4)[,3])
# Identification ----------------------------------------------------------
## Sign restrictions
set.seed(1234)
Signmat     <- matrix(c(1,1,1,-1,1,1,NA,-1,1), nrow = 3, ncol = 3)
SR          <- get.id.Sign(var4, Iter = 1000, Itermax = Inf, Signmat = Signmat, RHorizont = 0, Normalize = F, Step = 15, MT = T, Ci = 0.68, Plot = T, Hist = F, Epsname =  c("d", "s", "mp"))
## Identification by change in volatility
set.seed(1234)
CV          <- id.cv(var4, SB = c(1984, 1), frequency = 4)
CV          %>% summary
## Identification by minimizing distance covariance
set.seed(1234)
dCov        <- id.dc(var4)
dCov$B      <- dCov$B[,c(3,2,1)]
dCov$B[,3]  <- dCov$B[,3]*-1
dCov        %>% summary
## Identification by minimizing CvM distance
#set.seed(1234)
#CvM        <- id.cvm(var4, itermax = 2000, steptol = 200, iter2 = 200)
#CvM$B <- CvM$B[,c(3,2,1)]
#CvM$B[,1] <- CvM$B[,1] *-1
#CvM        %>% summary
#CvM %>% irf() %>% plot
#ggsave("../Plots/Tri_CvM.pdf", plot = last_plot(), width = 12, height = 8)
## Proxy SVAR
# Smets-Wouters (2007)
SW.raw      <- read.csv("Data/Instruments/SW.csv")
SW          <- ts(SW.raw[,-1], frequency = 4, start = c(floor(SW.raw$Year[1]), (SW.raw$Year[1] %% 1) / 0.25 + 1 ))
IV.SW       <- get.id.iv(var4, instruments = SW, Synchro = T)
IV.SW$B
IV.SW$F_test
#Box.test(SW, lag = 1, type = "Ljung-Box")
#Box.test(SW, lag = 2, type = "Ljung-Box")
#Box.test(SW, lag = 3, type = "Ljung-Box")
# Guerkaynak, Sack and Swanson (2005)
GSS.raw     <- read.csv("Data/Instruments/GSS.csv")
GSS         <- ts(GSS.raw[,-1], frequency = 4, start = c(floor(GSS.raw$Year[1]), (GSS.raw$Year[1] %% 1) / 0.25 + 1 ))
IV.GSS      <- get.id.iv(var4, instruments = GSS, Synchro = T)
IV.GSS$B
IV.GSS$F_test
# Romer Romer (2004)
RR.raw      <- read.csv("Data/Instruments/RR.csv")
RR          <- ts(RR.raw[,-1], frequency = 4, start = c(floor(RR.raw$Year[1]), (RR.raw$Year[1] %% 1) / 0.25 + 1 ))
RR          <- Remove_AC(RR, lag = 1)
IV.RR       <- get.id.iv(var4, instruments = RR, Synchro = T)
IV.RR$B
IV.RR$F_test
#Box.test(RR, lag = 1, type = "Ljung-Box")
#Box.test(RR, lag = 2, type = "Ljung-Box")
#Box.test(RR, lag = 3, type = "Ljung-Box")
# Sims Zha (2006)
SZ.raw      <- read.csv("Data/Instruments/SZ.csv")
SZ          <- ts(SZ.raw[,-1], frequency = 4, start = c(floor(SZ.raw$Year[1]), (SZ.raw$Year[1] %% 1) / 0.25 + 1 ))
SZ          <- Remove_AC(SZ, 2)
IV.SZ       <- get.id.iv(var4, instruments = SZ, Synchro = T)
IV.SZ$B
IV.SZ$F_test
#Box.test(SZ, lag = 1, type = "Ljung-Box")
#Box.test(SZ, lag = 2, type = "Ljung-Box")
#Box.test(SZ, lag = 3, type = "Ljung-Box")
#Box.test(SZ, lag = 4, type = "Ljung-Box")
# PCA ---------------------------------------------------------------------
iv2ts <- function(x, varname){
erg <- data.frame(x %>% time %>% as.numeric(),  x)
colnames(erg) <- c("time", varname)
return(erg)}
SW.ts <- iv2ts(SW, "SW")
GSS.ts <- iv2ts(GSS, "GSS")
RR.ts <- iv2ts(RR, "RR")
SZ.ts <- iv2ts(SZ, "SZ")
Epsname = c("d", "s", "mp")
# pi ----------------------------------------------------------------------
hd_pi_SR <- hd.mod(SR, series = 2, Partial = NULL, Epsname)
hd_pi_SR_mp <- hd.mod(SR, series = 2, Partial = 3, Epsname)
hd_pi_CV <- hd.mod(CV, series = 2, Partial = NULL, Epsname)
hd_pi_CV_mp <- hd.mod(CV, series = 2, Partial = 3, Epsname)
hd_pi_dCov <- hd.mod(dCov, series = 2, Partial = NULL, Epsname)
hd_pi_dCov_mp <- hd.mod(dCov, series = 2, Partial = 3, Epsname)
hd_pi_SW_mp <- hd.mod(IV.SW, series = 2, Partial = 3, Epsname)
hd_pi_RR_mp <- hd.mod(IV.RR, series = 2, Partial = 3, Epsname)
hd_pi_SZ_mp <- hd.mod(IV.SZ, series = 2, Partial = 3, Epsname)
hd_pi_RR_mp_pro <- hd.mod(IV.RR_pro, series = 2, Partial = 3, Epsname)
hd_pi_SZ_mp_pro <- hd.mod(IV.SZ_pro, series = 2, Partial = 3, Epsname)
## combined plot
hd_pi_mp <- hd_pi_SR_mp %>% left_join(hd_pi_dCov_mp, by = "t") %>%
left_join(hd_pi_CV_mp, by = "t") %>% left_join(hd_pi_SW_mp, by = "t") %>%
left_join(hd_pi_SZ_mp, by = "t") %>% left_join(hd_pi_RR_mp, by = "t") %>%
left_join(hd_pi_SZ_mp_pro, by = "t") %>% left_join(hd_pi_RR_mp_pro, by = "t") %>% tidyr::drop_na()
hd_pi_mp %<>% dplyr::filter(t >= 1973 & t <= 1983)
colnames(hd_pi_mp)[-1] <- c("SR", "dCov", "CV", "SW", "SZ", "RR", "SZ_pro", "RR_pro")
recessions_start <- c( 1973.75, 1980,1981.5)
recessions_end <- c( 1975, 1980.5,1982.75)
hd_pi_mp %<>% reshape2::melt(id = "t")
## subsets
hd_pi_mp %<>% add_column(lab = "old") %>% mutate(lab = ifelse(variable == "SZ_pro" | variable == "RR_pro", "new", "old"))
hd_pi_mp[247:287,2] <- "SZ"
hd_pi_mp[288:328,2] <- "RR"
hd_pi_mp$lab %>% factor()
hd_pi_mp_plot <- hd_pi_mp %>% ggplot(aes(x = t, y = value)) + facet_wrap(~variable, ncol = 3) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_mp$t[1] %>% ceiling(),hd_pi_mp$t[nrow(hd_pi_mp)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line(data = subset(hd_pi_mp, lab == "old"), linetype = "solid") +
geom_line(data = subset(hd_pi_mp, lab == "new"), linetype = "dashed") +
xlab("") + ylab("")
hd_pi_mp_plot
# Waschmaschine -----------------------------------------------------------
demand_cv   <- solve(CV$B)        %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(1)
demand_cv <- cbind(time(var4$y)[-c(1:4)], demand_cv); colnames(demand_cv) <- c("time", "demand_cv")
supply_cv     <- solve(CV$B)          %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(2)
supply_cv <- cbind(time(var4$y)[-c(1:4)], supply_cv); colnames(supply_cv) <- c("time", "supply_cv")
non_mp_cv <- left_join(demand_cv, supply_cv, by = "time")
#temp <- left_join(non_mp_cv, SW.ts, by = "time") %>% tidyr::drop_na()
#SW_pro <- data.frame("time" = temp$time, "SW_pro" =  lm(temp$SW ~ temp[,2:3] %>% as.matrix()-1) %>% resid())
#SW_pro <- ts(SW_pro$SW_pro, frequency = 4, start = c(floor(SW_pro$time[1]), (SW_pro$time[1] %% 1) / 0.25 + 1 ))
#IV.SW_pro       <- get.id.iv(var4, instruments = SW_pro, Synchro = T)
#IV.SW_pro$B
#IV.SW_pro$F_test
# RR_pro
temp <- left_join(non_mp_cv, RR.ts, by = "time") %>% tidyr::drop_na()
lm1 <-  lm(temp$RR ~ temp[,2:3] %>% as.matrix()-1)
RR_pro <- data.frame("time" = temp$time, "RR_pro" =  lm1 %>% resid())
RR_pro <- ts(RR_pro$RR_pro, frequency = 4, start = c(floor(RR_pro$time[1]), (RR_pro$time[1] %% 1) / 0.25 + 1 ))
IV.RR_pro <- get.id.iv(var4, instruments = RR_pro, Synchro = T)
IV.RR_pro$B
IV.RR_pro$F_test
#SZ_pro
temp <- left_join(non_mp_cv, SZ.ts, by = "time") %>% tidyr::drop_na()
lm2 <- lm(temp$SZ ~ temp[,2:3] %>% as.matrix()-1)
SZ_pro <- data.frame("time" = temp$time, "SZ_pro" =  lm2 %>% resid())
SZ_pro <- ts(SZ_pro$SZ_pro, frequency = 4, start = c(floor(SZ_pro$time[1]), (SZ_pro$time[1] %% 1) / 0.25 + 1 ))
IV.SZ_pro <- get.id.iv(var4, instruments = SZ_pro, Synchro = T)
IV.SZ_pro$B
IV.SZ_pro$F_test
Epsname = c("d", "s", "mp")
# pi ----------------------------------------------------------------------
hd_pi_SR <- hd.mod(SR, series = 2, Partial = NULL, Epsname)
hd_pi_SR_mp <- hd.mod(SR, series = 2, Partial = 3, Epsname)
hd_pi_CV <- hd.mod(CV, series = 2, Partial = NULL, Epsname)
hd_pi_CV_mp <- hd.mod(CV, series = 2, Partial = 3, Epsname)
hd_pi_dCov <- hd.mod(dCov, series = 2, Partial = NULL, Epsname)
hd_pi_dCov_mp <- hd.mod(dCov, series = 2, Partial = 3, Epsname)
hd_pi_SW_mp <- hd.mod(IV.SW, series = 2, Partial = 3, Epsname)
hd_pi_RR_mp <- hd.mod(IV.RR, series = 2, Partial = 3, Epsname)
hd_pi_SZ_mp <- hd.mod(IV.SZ, series = 2, Partial = 3, Epsname)
hd_pi_RR_mp_pro <- hd.mod(IV.RR_pro, series = 2, Partial = 3, Epsname)
hd_pi_SZ_mp_pro <- hd.mod(IV.SZ_pro, series = 2, Partial = 3, Epsname)
## combined plot
hd_pi_mp <- hd_pi_SR_mp %>% left_join(hd_pi_dCov_mp, by = "t") %>%
left_join(hd_pi_CV_mp, by = "t") %>% left_join(hd_pi_SW_mp, by = "t") %>%
left_join(hd_pi_SZ_mp, by = "t") %>% left_join(hd_pi_RR_mp, by = "t") %>%
left_join(hd_pi_SZ_mp_pro, by = "t") %>% left_join(hd_pi_RR_mp_pro, by = "t") %>% tidyr::drop_na()
hd_pi_mp %<>% dplyr::filter(t >= 1973 & t <= 1983)
colnames(hd_pi_mp)[-1] <- c("SR", "dCov", "CV", "SW", "SZ", "RR", "SZ_pro", "RR_pro")
recessions_start <- c( 1973.75, 1980,1981.5)
recessions_end <- c( 1975, 1980.5,1982.75)
hd_pi_mp %<>% reshape2::melt(id = "t")
## subsets
hd_pi_mp %<>% add_column(lab = "old") %>% mutate(lab = ifelse(variable == "SZ_pro" | variable == "RR_pro", "new", "old"))
hd_pi_mp[247:287,2] <- "SZ"
hd_pi_mp[288:328,2] <- "RR"
hd_pi_mp$lab %>% factor()
hd_pi_mp_plot <- hd_pi_mp %>% ggplot(aes(x = t, y = value)) + facet_wrap(~variable, ncol = 3) +
theme_bw() + geom_hline(yintercept = 0, color = "red", alpha = 0.5) +
scale_x_continuous(breaks = seq(hd_pi_mp$t[1] %>% ceiling(),hd_pi_mp$t[nrow(hd_pi_mp)], by = 2)) +
annotate("rect", xmin = recessions_start, xmax = recessions_end, ymin = -Inf, ymax = Inf, alpha = 0.3) +
geom_line(data = subset(hd_pi_mp, lab == "old"), linetype = "solid") +
geom_line(data = subset(hd_pi_mp, lab == "new"), linetype = "dashed") +
xlab("") + ylab("")
hd_pi_mp_plot
# Correlation of MP shocks ------------------------------------------------
mp_sr     <- solve(SR$IRF.M[,,1]) %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_cv     <- solve(CV$B)          %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_dcov   <- solve(dCov$B)        %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_noniv  <- cbind(mp_sr, mp_cv, mp_dcov); colnames(mp_noniv) <- c("SR", "CV", "dCov")
mp_iv     <- left_join(IV.SW$eps.ts, IV.SZ$eps.ts, by = "time")
mp_iv     <- left_join(mp_iv, IV.RR$eps.ts, by = "time") %>% tidyr::drop_na()
# Correlation of MP shocks ------------------------------------------------
mp_sr     <- solve(SR$IRF.MT[,,1]) %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_cv     <- solve(CV$B)          %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_dcov   <- solve(dCov$B)        %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(3)
mp_noniv  <- cbind(mp_sr, mp_cv, mp_dcov); colnames(mp_noniv) <- c("SR", "CV", "dCov")
mp_iv     <- left_join(IV.SW$eps.ts, IV.SZ$eps.ts, by = "time")
mp_iv     <- left_join(mp_iv, IV.RR$eps.ts, by = "time") %>% tidyr::drop_na()
colnames(mp_iv) <- c("time", "SW", "SZ", "RR")
mp_noniv  <- cbind(time(var4$y)[-c(1:4)], mp_noniv); colnames(mp_noniv)[1] <- "time"
mp_all    <- left_join(mp_noniv, mp_iv, by = "time") %>% tidyr::drop_na()
cor(mp_all) %>% kableExtra::kable(format = "latex", booktabs = T, digits = 2, linesep = "")
mp_sds <- mp_all %>% select(-1) %>% apply( 2, sd)
mp_all_stand <- mp_all
for (j in 1:dim(mp_all)[1]) {
for (i in 2:7) {
mp_all_stand[j,i] <- mp_all[j,i] / mp_sds[i-1]
}
}
mp_all_stand %>% select(-1) %>% apply( 2, sd)
mp_all_plot3 <- reshape2::melt( mp_all_stand, id.var = "time")
library(ggplot2)
mp_all_plot3$variable <- factor(  mp_all_plot3$variable, levels = c(   "CV",   "dCov", "SW",   "SZ",   "RR","SR" ))
MP_shock_plot3 <- ggplot(mp_all_plot3, aes(x = time, y = value, group = variable)) +
geom_line(aes(linetype = variable, color = variable), size = 0.7) +
scale_x_continuous(breaks = seq(mp_all_stand$time[1] %>% ceiling(),mp_all_stand$time[nrow(mp_all_stand)], 2)) +
xlab("") + ylab(" ")  + theme_bw() + theme(legend.title = element_blank()) +
geom_hline(yintercept = c(-1, 1), linetype = "dashed", alpha = 0.3) + scale_color_ochre(palette="lorikeet")+
annotate("rect", xmin = Start, xmax = End2, ymin = -Inf, ymax = Inf, alpha = 0.3) + ylim(-4.5, 4.5)
# Cormat
new_cormat <- mp_all %>% left_join(IV.RR_pro$eps.ts, by = "time") %>% left_join(IV.SZ_pro$eps.ts, by = "time")
colnames(new_cormat)[c(8,9)] <- c("RR_pro", "SZ_pro")
new_cormat %>% select(-1) %>% cor %>% round(3) %>% kableExtra::kable(format = "latex", booktabs = T, digits = 3, linesep = "")
new_cormat %>% select(-1) %>% cor %>% round(3)
library(ggplot2)
mp_all_plot3$variable <- factor(  mp_all_plot3$variable, levels = c(   "CV",   "dCov", "SW",   "SZ",   "RR","SR" ))
MP_shock_plot3 <- ggplot(mp_all_plot3, aes(x = time, y = value, group = variable)) +
geom_line(aes(linetype = variable, color = variable), size = 0.7) +
scale_x_continuous(breaks = seq(mp_all_stand$time[1] %>% ceiling(),mp_all_stand$time[nrow(mp_all_stand)], 2)) +
xlab("") + ylab(" ")  + theme_bw() + theme(legend.title = element_blank()) +
geom_hline(yintercept = c(-1, 1), linetype = "dashed", alpha = 0.3) + scale_color_ochre(palette="lorikeet")+
annotate("rect", xmin = Start, xmax = End2, ymin = -Inf, ymax = Inf, alpha = 0.3) + ylim(-4.5, 4.5)
mp_all_plot3$variable <- factor(  mp_all_plot3$variable, levels = c(   "CV",   "dCov", "SW",   "SZ",   "RR","SR" ))
MP_shock_plot3 <- ggplot(mp_all_plot3, aes(x = time, y = value, group = variable)) +
geom_line(aes(linetype = variable, color = variable), size = 0.7) +
scale_x_continuous(breaks = seq(mp_all_stand$time[1] %>% ceiling(),mp_all_stand$time[nrow(mp_all_stand)], 2)) +
xlab("") + ylab(" ")  + theme_bw() + theme(legend.title = element_blank()) +
geom_hline(yintercept = c(-1, 1), linetype = "dashed", alpha = 0.3) + scale_color_ochre(palette="lorikeet")
#annotate("rect", xmin = Start, xmax = End2, ymin = -Inf, ymax = Inf, alpha = 0.3) + ylim(-4.5, 4.5)
MP_shock_plot3
MP_shocks_plotSW_Fa_df <- IV.SW$eps.ts %>% left_join(FaIV.SW$eps.ts, by = "time") %>% filter(time >= mp_all_stand$time[1] & time <= mp_all_stand$time[nrow(mp_all_stand)])
# FAVAR -------------------------------------------------------------------
r <- 3
SDFM <- FALSE
source("Fa.R")
colnames(USA_FAVAR) <- c(colnames(USA_Tri), 1:r)
favar4 <- VAR(USA_FAVAR, p = 4, type = "const")
FaIV.SW      <- get.id.iv(favar4, instruments = SW, Synchro = T)
FaIV.RR       <- get.id.iv(favar4, instruments = RR, Synchro = T)
FaIV.SZ       <- get.id.iv(favar4, instruments = SZ, Synchro = T)
mp_iv_fa     <- left_join(FaIV.SW$eps.ts, FaIV.SZ$eps.ts, by = "time")
mp_iv_fa     <- left_join(mp_iv_fa, FaIV.RR$eps.ts, by = "time") %>% tidyr::drop_na()
colnames(mp_iv_fa) <- c("time", "SW", "SZ", "RR")
mp_iv_fa_tab <-  mp_iv_fa %>% filter(time == 1974.25 | time == 1979.75 | time == 1988.75 | time == 1994 | time == 1990.75 | time == 1998.75 | time == 2001.25| time == 2002.75)
mp_iv_fa_tab[c(4,5),] <- mp_iv_fa_tab[c(5,4),]
mp_iv_fa_tab %>% t() %>% kableExtra::kable(format = "latex", booktabs = T, digits = 3, linesep = "")
# Inference
set.seed(1234)
MP_shocks_plotSW_Fa_df <- IV.SW$eps.ts %>% left_join(FaIV.SW$eps.ts, by = "time") %>% filter(time >= mp_all_stand$time[1] & time <= mp_all_stand$time[nrow(mp_all_stand)])
MP_shocks_plotSW_Fa_df[,-1] <- scale(MP_shocks_plotSW_Fa_df[,-1], center = F)
colnames(MP_shocks_plotSW_Fa_df)[-1] <- c("VAR", "FAVAR")
MP_shocks_plotSW_Fa_df_long <-  reshape2::melt(MP_shocks_plotSW_Fa_df, id.var = "time")
MP_shocks_plotSW_Fa <- ggplot(MP_shocks_plotSW_Fa_df_long, aes(x = time, y = value, group = variable)) +
geom_line(aes(linetype = variable)) + scale_linetype_manual(values = c("solid","longdash")) +
scale_x_continuous(breaks = seq(mp_all_stand$time[1] %>% ceiling(),mp_all_stand$time[nrow(mp_all_stand)], 2)) +
xlab("") + ylab(" ")  + theme_bw()  + geom_hline(yintercept = c(-1, 1), linetype = "dashed", alpha = 0.3) +
#annotate("rect", xmin = Start, xmax = End2, ymin = -Inf, ymax = Inf, alpha = 0.3) +
theme(legend.title = element_blank()) + ylim(-4.5, 4.5)
new_shock_plots <- grid.arrange(MP_shock_plot3, MP_shocks_plotSW_Fa, ncol = 1)
ggsave("../Plots/MP_shocks3_Fa3_new.pdf", plot = new_shock_plots, width = 12, height = 6)
# Waschmaschine -----------------------------------------------------------
demand_cv   <- solve(CV$B)        %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(1)
demand_cv <- cbind(time(var4$y)[-c(1:4)], demand_cv); colnames(demand_cv) <- c("time", "demand_cv")
supply_cv     <- solve(CV$B)          %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(2)
supply_cv <- cbind(time(var4$y)[-c(1:4)], supply_cv); colnames(supply_cv) <- c("time", "supply_cv")
non_mp_cv <- left_join(demand_cv, supply_cv, by = "time")
non_mp_cv
mp_sr
non_mp_cv %>% dim
mp_sr %>% dim
non_mp_cv
temp = cbind(mp_sr, non_mp_cv %>% select(-1))
temp
mp_sr
colnames(temp)[1] = "SR"
temp %>% head
cor(temp)
2/sqrt(171)
lm(SR~demand_cv + supply_cv - 1, data = temp)
lm(SR~demand_cv + supply_cv - 1, data = temp) %>% summary
# Event analysis ----------------------------------------------------------
# April 1974, October 1979, December 1988 and February 1994 - were contractionary
# December 1990, October 1998, April 2001, and November 2002  -were expansionary
mp_all_tab <- mp_all %>% filter(time == 1974.25 | time == 1979.75 | time == 1988.75 | time == 1994 | time == 1990.75 | time == 1998.75 | time == 2001.25| time == 2002.75)
#mp_all_stand_tab <- mp_all_stand_tab %>% select(-SR)
mp_all_tab <- mp_all_tab %>% add_column(SUM = rowSums(mp_all_tab[,-1]))
mp_all_tab[c(4,5),] <- mp_all_tab[c(5,4),]
mp_all_tab %>% t() %>% kableExtra::kable(format = "latex", booktabs = T, digits = 3, linesep = "")
mp_all %>% select(-1) %>% apply( 2, sd)
# Decompose Xi ------------------------------------------------------------
demand_cv   <- solve(CV$B)        %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(1)
demand_cv <- cbind(time(var4$y)[-c(1:4)], demand_cv); colnames(demand_cv) <- c("time", "demand_cv")
supply_cv     <- solve(CV$B)          %*% t(resid(var4)) %>% t() %>% as.data.frame() %>% select(2)
supply_cv <- cbind(time(var4$y)[-c(1:4)], supply_cv); colnames(supply_cv) <- c("time", "supply_cv")
non_mp_cv <- left_join(demand_cv, supply_cv, by = "time")
tempdat <- cbind(non_mp_cv, mp_cv) %>% left_join(IV.SW$eps.ts, by = "time") %>% left_join(IV.RR$eps.ts, by = "time") %>% left_join(IV.SZ$eps.ts, by = "time")
non_mp_cv
tempdat <- cbind(non_mp_cv, mp_cv) %>% left_join(IV.SW$eps.ts, by = "time") %>% left_join(IV.RR$eps.ts, by = "time") %>% left_join(IV.SZ$eps.ts, by = "time")
colnames(tempdat)[c(4,5,6,7)] <- c("mp_cv", "mp_sw", "mp_rr", "mp_sz")
# RR
topmod1 <-  lm(mp_sw ~ mp_rr-1, data = tempdat %>% tidyr::drop_na())
topmod2 <-  lm(mp_rr ~ demand_cv + supply_cv-1, data = tempdat %>% tidyr::drop_na())
summary(topmod1)$coeff %>% round(3)
summary(topmod2)$coeff %>% round(3)
